# 수능1번 — 전체 게임 평가 및 개선 계획

## 1. 현재 게임 평가

### 1.1 게임 개요
- **장르**: 수능형 수학 타임어택 퀴즈 게임
- **기술 스택**: Next.js 16, React 19, Tailwind CSS v4, Vercel Blob, Web Audio API
- **핵심 루프**: 60초 제한 시간 내 수학 문제를 최대한 많이 풀고, 콤보/피버를 활용해 고득점을 노리는 구조
- **문제 유형**: 지수(exp), 미분(diff), 수열/시그마(seq), 적분(int), 로그(log) — 총 5가지

### 1.2 현재 강점
- 수능 시험지 디자인을 충실히 재현한 UI (한교평 스타일 패러디)
- seed 기반 결정론적 문제 생성으로 서버 사이드 리플레이 검증 가능
- HMAC 세션 토큰 + 리플레이 검증 등 기본적인 치팅 방지 구조
- 콤보 → 피버 → 레벨업 → 마일스톤 보너스까지 이어지는 보상 체계
- Web Audio API로 외부 파일 없이 효과음 구현
- 모바일 대응 (터치, 스크롤 방지 등)

### 1.3 현재 약점 (종합)

| 영역 | 심각도 | 핵심 문제 |
|------|--------|-----------|
| 콘텐츠 다양성 | 높음 | 5가지 문제 유형이 반복되어 금방 식상해짐 |
| 유저 리텐션 | 높음 | 1회 플레이 후 재방문 동기가 부족 |
| 코드 구조 | 중간 | SuneungGame.tsx 498줄 모놀리식, 중복 정의, 테스트 전무 |
| 접근성 | 중간 | 키보드 내비게이션, 스크린 리더, 색 대비 미흡 |
| 확장성 | 중간 | 리더보드가 단일 JSON 파일, 동시성 이슈 가능 |
| 게임 밸런스 | 중간 | 시간 보너스/감점 공식이 직관적이지 않음 |
| 사용자 피드백 | 낮음 | 오답 시 정답 확인 시간(300ms)이 너무 짧음 |

---

## 2. 개선 계획

### Phase 1: 핵심 게임플레이 개선 (우선순위 최상)

#### 2.1 문제 유형 확장
- **현황**: 5가지 유형(지수, 미분, 수열, 적분, 로그)만 존재
- **개선 방향**:
  - 삼각함수 문제 유형 추가 (sin, cos, tan 기본값 계산)
  - 함수의 연속성 문제 추가 (구간별 정의 함수의 상수 결정)
  - 등비급수 수렴/합 문제 추가
  - 조합/순열 기초 문제 추가
  - 절대부등식/이차부등식 문제 추가
- **기대 효과**: 문제 풀이 다양성 확보로 반복 플레이 피로도 감소

#### 2.2 난이도 시스템 리워크
- **현황**: 레벨 1~5에서 출제 가능한 문제 유형만 필터링하는 단순 구조
- **개선 방향**:
  - 같은 유형 내에서도 계수 범위, 차수 등으로 세분화된 난이도 적용
  - 적응형 난이도 시스템: 연속 정답 속도에 따라 동적으로 난이도 조절
  - 레벨별 시각적 차별화 강화 (배경 색상 변화, 문제 영역 시각 효과 등)
- **기대 효과**: 실력에 맞는 도전감 유지, 고수/초보 모두 만족

#### 2.3 오답 피드백 개선
- **현황**: 오답 시 300ms 후 즉시 다음 문제로 넘어감
- **개선 방향**:
  - 오답 시 피드백 시간을 600~800ms로 늘려 정답을 확인할 수 있게 함
  - 정답 선택지 하이라이트와 함께 간단한 풀이 힌트 표시 (선택 사항)
  - 결과 화면에서 틀린 문제 목록 리뷰 기능 추가
- **기대 효과**: 학습 효과 강화, 게임의 교육적 가치 증대

#### 2.4 밸런스 조정
- **현황**: 시간 보너스 공식이 `Math.max(2, Math.round(12 * Math.exp(-newCombo / 12)))` 등 복잡하고 직관적이지 않음
- **개선 방향**:
  - 시간 보너스 공식 단순화 및 예측 가능성 향상
  - 오답 시 감점 공식 재조정: 현재 콤보 기반 가변 시간 감점이 과도할 수 있음
  - 점수 획득 방식을 UI에 간략하게 표시하여 투명성 확보
  - 레벨 5 이상에서의 고정 15초 시간 보너스 재검토 (너무 관대)
- **기대 효과**: 점수 체계에 대한 이해도 향상, 공정한 경쟁 환경

---

### Phase 2: 유저 리텐션 및 콘텐츠 (우선순위 높음)

#### 2.5 게임 모드 다양화
- **현황**: 60초 타임어택 단일 모드
- **개선 방향**:
  - **데일리 챌린지 모드**: 매일 같은 seed로 모든 유저가 동일 문제를 풀고 순위 경쟁
  - **연습 모드**: 시간 제한 없이 유형별로 문제를 풀어볼 수 있는 모드
  - **서바이벌 모드**: 3회 오답 시 게임 종료, 시간 제한 없음
  - **스프린트 모드**: 20문제를 최단 시간에 풀기
- **기대 효과**: 다양한 플레이 패턴 수용, 재방문 동기 강화

#### 2.6 개인 통계 및 히스토리
- **현황**: 플레이 기록이 전혀 저장되지 않음 (리더보드 점수만 존재)
- **개선 방향**:
  - localStorage 기반 개인 플레이 히스토리 저장 (최근 N회)
  - 개인 최고 기록(Personal Best) 표시
  - 유형별 정답률 통계 (지수 90%, 로그 60% 등)
  - 플레이 횟수, 총 풀이 문제 수, 평균 정답률 등 누적 통계
  - 성장 그래프 (일별/주별 점수 추이)
- **기대 효과**: 자기 성장 확인 → 내적 동기 부여 → 재방문율 증가

#### 2.7 업적/배지 시스템
- **현황**: 콤보 마일스톤 팝업 외 보상 체계 없음
- **개선 방향**:
  - 다양한 달성 조건의 배지 시스템 도입
    - 예: "첫 10콤보", "정답률 100%", "50문제 돌파", "적분 마스터" 등
  - 달성 시 시각적/음향 연출과 함께 배지 해금
  - 프로필 또는 리더보드에 대표 배지 표시
- **기대 효과**: 수집 욕구 자극, 장기 목표 제공

#### 2.8 리더보드 고도화
- **현황**: 전체 Top 10만 표시, 본인 순위는 결과 화면에서만 확인 가능
- **개선 방향**:
  - 본인 순위 및 근처 순위 항상 표시 (전체 순위 + 내 주변 ±3위)
  - 주간/월간/전체 기간별 리더보드
  - 데일리 챌린지 모드용 별도 리더보드
  - 리더보드에 정답률, 최대 콤보 등 부가 정보 표시
  - 친구 초대 후 친구 간 순위 비교 기능
- **기대 효과**: 경쟁심 자극, 사회적 연결감

---

### Phase 3: UX/UI 개선 (우선순위 중간)

#### 2.9 언어 일관성
- **현황**: UI는 한국어인데 결과 화면 등급 텍스트가 영어 ("Excellent!", "Great Job!")
- **개선 방향**:
  - 모든 텍스트 한국어 통일 ("수석!", "우수!", "양호!", "분발!" 등 수능 스타일)
  - 또는 "1등급", "2등급" 같은 수능 등급 체계 차용
- **기대 효과**: 몰입감 향상, 테마 일관성

#### 2.10 문제 전환 연출
- **현황**: 문제가 즉시 교체되어 시각적 흐름이 끊김
- **개선 방향**:
  - 문제 간 슬라이드/페이드 전환 애니메이션 추가
  - 정답 시 원형 마킹 애니메이션 후 자연스러운 전환
  - 콤보 구간별 배경 또는 테마 색상 변화 (점점 더 뜨거워지는 느낌)
- **기대 효과**: 시각적 쾌감 증가, 게임의 완성도 향상

#### 2.11 결과 화면 강화
- **현황**: 점수, 정답률, 최대 콤보만 표시
- **개선 방향**:
  - 문제별 정답/오답 리스트 (틀린 문제 다시 풀기 기능 포함)
  - 유형별 성적 분석 차트
  - 이전 기록 대비 향상/하락 표시
  - 등급 판정 시스템 (수능 등급컷 패러디)
  - 성적표 이미지 생성 및 공유 기능 (캔버스 기반 이미지 export)
- **기대 효과**: 결과에 대한 만족감, SNS 공유 촉진

#### 2.12 모바일 UX 개선
- **현황**: 기본 모바일 대응은 되어 있으나 최적화 부족
- **개선 방향**:
  - 하단 고정 바가 콘텐츠를 가리는 문제 해결 (현재 pb-24 핵 사용)
  - 햅틱 피드백 (navigator.vibrate) 적용: 정답/오답/레벨업
  - 스와이프 제스처로 답안 선택 (선택 사항)
  - 가로 모드 대응
  - PWA 설치 지원 (manifest.json, 서비스 워커)
- **기대 효과**: 모바일 유저 경험 개선, 앱 느낌 제공

#### 2.13 다크 모드
- **현황**: CSS 변수에 다크 배경 색상이 정의되어 있으나 미구현
- **개선 방향**:
  - 시스템 설정 연동 다크 모드 지원
  - 수동 토글 옵션
  - 게임 화면, 홈 화면, 결과 화면 모두 대응
- **기대 효과**: 야간 플레이 편의성, 현대적 UI

---

### Phase 4: 코드 품질 및 기술 개선 (우선순위 중간)

#### 2.14 컴포넌트 구조 리팩토링
- **현황**: SuneungGame.tsx 498줄에 모든 게임 로직/UI가 집중
- **개선 방향**:
  - 게임 상태 관리 로직을 커스텀 훅으로 분리 (useGameState, useCombo, useTimer)
  - UI 컴포넌트 분리 (GameHeader, QuestionCard, ChoiceList, StatusBar, FeedbackOverlay)
  - 중복 인터페이스 정의 통합 (GameResult, PlayedQuestion을 공유 types 파일로)
  - 중복 keyframe 애니메이션 정리 (globals.css와 인라인 JSX 중복 제거)
- **기대 효과**: 유지보수성 향상, 기능 추가 시 수월함

#### 2.15 테스트 도입
- **현황**: 테스트가 전혀 없음
- **개선 방향**:
  - MathGenerator 단위 테스트: 모든 문제 유형이 유효한 정답과 선택지를 생성하는지 검증
  - 점수 계산 로직 테스트
  - API 라우트 통합 테스트 (세션 생성, 점수 제출, 토큰 검증)
  - 컴포넌트 렌더링 테스트 (React Testing Library)
- **기대 효과**: 리팩토링/기능 추가 시 안전성 확보

#### 2.16 타입 안전성 강화
- **현황**: `window as any`, `e: any` 등 any 타입 사용, 일부 타입 미정의
- **개선 방향**:
  - 모든 any 타입 제거 및 명시적 타입 정의
  - API 요청/응답 타입 공유 (클라이언트 ↔ 서버)
  - MathGenerator의 QType을 문제 생성기와 선택지 생성기에서 일관되게 사용
- **기대 효과**: 런타임 에러 예방, 개발 생산성 향상

#### 2.17 성능 최적화
- **현황**: 외부 폰트 5개 이상 로드, 외부 배경 이미지 사용
- **개선 방향**:
  - 폰트 서브셋 적용 (한글 필수 글자만 로드)
  - 중요 폰트만 preload, 나머지 지연 로드
  - 외부 배경 이미지를 로컬 에셋으로 전환 또는 CSS 그래디언트 대체
  - React.memo / useMemo 적용으로 불필요한 리렌더링 방지
  - KaTeX CSS를 self-host로 전환하여 CDN 의존성 제거
- **기대 효과**: 초기 로딩 속도 개선, LCP/FCP 향상

---

### Phase 5: 인프라 및 보안 (우선순위 낮음~중간)

#### 2.18 리더보드 스토리지 개선
- **현황**: Vercel Blob에 단일 JSON 파일로 저장, 읽기/쓰기 시 전체 데이터 로드
- **개선 방향**:
  - 데이터베이스 도입 (Vercel KV/Redis, Supabase, PlanetScale 등)
  - 동시 쓰기 시 데이터 유실 방지 (현재 read-modify-write 패턴에 race condition 존재)
  - 유저 수 증가에 대비한 페이지네이션 지원
  - 캐싱 레이어 추가 (리더보드 읽기 빈도 대비 쓰기 빈도가 낮을 것)
- **기대 효과**: 데이터 안정성 확보, 확장성 개선

#### 2.19 보안 강화
- **현황**: 기본적인 HMAC 토큰 검증 + 리플레이 검증 존재
- **개선 방향**:
  - SESSION_SECRET 하드코딩 폴백 제거 (환경변수 필수화)
  - API 엔드포인트에 rate limiting 추가 (점수 제출, 세션 생성)
  - 클라이언트 사이드 시간 조작 감지 (서버 타임스탬프 대조)
  - 리플레이 검증 시 정답 수와 실제 점수의 정밀 대조 강화 (현재 maxPossibleScore가 6000*문제수로 너무 관대)
  - 동일 유저 동시 세션 방지
- **기대 효과**: 치팅 방지 강화, 리더보드 신뢰성

#### 2.20 접근성(Accessibility) 개선
- **현황**: 키보드 내비게이션, 스크린 리더 지원 미비
- **개선 방향**:
  - 게임 중 키보드 숫자(1~5)로 답안 선택 기능
  - 모든 인터랙티브 요소에 적절한 ARIA 레이블 추가
  - 색상 대비 비율 WCAG AA 이상 준수
  - 포커스 인디케이터 시각적 표시
  - 효과음에 대응하는 시각적 피드백 보장 (청각 장애 대응)
- **기대 효과**: 접근성 기준 충족, 사용자층 확대

---

## 3. 실행 우선순위 매트릭스

```
영향력 높음 │ [2.5 게임 모드]    [2.1 문제 유형 확장]
            │ [2.6 개인 통계]    [2.3 오답 피드백]
            │ [2.8 리더보드]     [2.4 밸런스 조정]
            │──────────────────────────────────────
            │ [2.11 결과 화면]   [2.2 난이도 시스템]
            │ [2.9 언어 일관성]  [2.7 업적/배지]
            │ [2.12 모바일 UX]   [2.14 리팩토링]
영향력 낮음 │ [2.13 다크 모드]   [2.15 테스트]
            └─────────────────────────────────────
              구현 난이도 낮음     구현 난이도 높음
```

## 4. 추천 실행 순서

| 순서 | 항목 | 근거 |
|------|------|------|
| 1 | 2.9 언어 일관성 | 노력 대비 효과 극대, 즉시 적용 가능 |
| 2 | 2.3 오답 피드백 개선 | 게임의 교육적 가치 및 만족도 직결 |
| 3 | 2.4 밸런스 조정 | 핵심 게임 경험 품질 |
| 4 | 2.1 문제 유형 확장 | 콘텐츠 다양성 = 리텐션의 핵심 |
| 5 | 2.6 개인 통계/히스토리 | 재방문 동기 부여 |
| 6 | 2.11 결과 화면 강화 | 공유/바이럴 촉진 |
| 7 | 2.8 리더보드 고도화 | 경쟁 요소 강화 |
| 8 | 2.2 난이도 시스템 리워크 | 게임 깊이 확장 |
| 9 | 2.5 게임 모드 다양화 | 콘텐츠 수명 연장 |
| 10 | 2.14 컴포넌트 리팩토링 | 이후 개발 효율성을 위한 투자 |
| 11 | 2.20 접근성 개선 | 사용자층 확대 |
| 12 | 2.12 모바일 UX 개선 | 주요 사용 환경 최적화 |
| 13 | 2.15 테스트 도입 | 안정성 확보 |
| 14 | 2.10 전환 애니메이션 | 완성도 향상 |
| 15 | 2.7 업적/배지 시스템 | 장기 리텐션 |
| 16 | 2.18 리더보드 스토리지 | 확장 대비 |
| 17 | 2.17 성능 최적화 | 로딩 속도 |
| 18 | 2.16 타입 안전성 | 코드 품질 |
| 19 | 2.19 보안 강화 | 신뢰성 |
| 20 | 2.13 다크 모드 | 부가 기능 |
