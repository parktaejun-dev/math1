# 중등 수학 타임어택 확장 계획서 (Arcade Rhythm Edition)

본 기획서는 '교육 학습'보다 **'아케이드 반응속도 게임'**으로서의 몰입감을 극대화하는 방향으로 재설계된 명세서입니다. 기존의 학년별 난이도 오름차순 배치 로직을 폐기하고, **풀이 소요 시간(Expected Solving Time)** 기반의 리듬 시스템을 도입합니다. 또한 동적 SVG를 활용한 기하(도형) 문제를 추가하여 다채로운 플레이 경험을 제공합니다.

---

## 1. 핵심 설계 철학: 리듬과 템포
* **난이도 중심(X) → 템포 중심(O):** 어려운 문제를 푸는 것이 아니라, 멈추지 않고 콤보를 이어나가는 '리듬감'이 게임의 핵심입니다.
* **풀이 시간 편차 억제:** 플레이어의 '멈칫(>6초)'을 유발하는 문제 배치는 시스템적으로 차단합니다.
* **결정론적 재현성:** 동일한 시드를 입력하면 100% 동일한 순서의 문제와 오답 보기가 생성되어야 합니다.

---

## 2. 레벨 시스템 및 문제 매핑 (시간 기반 재배치)

레벨은 문제의 수학적 난이도가 아닌, **목표 풀이 시간**을 기준으로 정의합니다.

| Level | 플레이 역할 | 목표 풀이시간 | 포함되는 문제 유형 (예시) |
| :--- | :--- | :--- | :--- |
| **Level 1** | **반사** | `0.7~1.5s` | 사분면 판별, 간단 정수 사칙연산, 동일밑 지수법칙, 특수각 값 암기 |
| **Level 2** | **직관** | `1.5~3.0s` | 소인수분해 약수 개수, 간단 일차방정식($ax+b=c$), 평균/중앙값(3개), 제곱수 판별 |
| **Level 3** | **판단** | `3.0~5.0s` | 유한소수 판별, 일차함수 기울기, 근호 간소화, 부등식 방향 판별 |
| **Level 4** | **사고** | `5.0~7.0s` | 인수분해, 이차방정식 근, **피타고라스 정리 (SVG 도형)**, 이차함수 꼭짓점 |
| **Level 5** | **피버** | `0.8~2.0s` | 특수각 연산 혼합, **원주각 성질 (SVG 도형)**, 대표값 혼합형, 패턴형 계산 |

---

## 3. 동적 기하(도형) 문제 렌더링 (SVG)
텍스트를 읽는 인지 부담(4~6초)을 줄이고 시각 패턴 인식(1.5~2초)을 극대화하기 위해 도형 문제를 투입합니다.
* **고정 템플릿 방식**: 도형의 형태, 크기 비례, 레이아웃은 **완전히 고정**합니다. (인지 부담 최소화)
* **숫자/라벨 렌더링**: 도형 템플릿 위 지정된 고정 위치에 KaTeX 라벨(길이, 각도)만 동적으로 변경하여 그려냅니다. 화면 전체의 깜빡임이나 도형 변형(애니메이션)은 일절 금지합니다.
* 예: **Level 4 피타고라스 정리**, **Level 5 원주각 성질**

---

## 4. 데이터 구조 및 리듬 보호 시스템

### Question 데이터 구조
```ts
type CognitiveType = "reflex" | "pattern" | "compute" | "think";

type Question = {
  id: string;
  latex: string;
  answer: number;
  choices: number[];
  level: 1 | 2 | 3 | 4 | 5;
  cognitiveType: CognitiveType; // ★ 난이도/시간 대신 인지 타입으로 제어
  type: string;
}
```

### 문제 선택 알고리즘 (인지 흐름 및 다양성 제어)
단순 랜덤이나 고정 난이도 큐가 아닌, **뇌의 인지 스위칭(Cognitive Switching)** 기반으로 문제를 배치합니다.

1. **리듬 보호 (인지 지연 방지)**: 
    * `think` 타입 직후에 다시 `think` 타입이 나오는 것을 금지합니다.
    * `compute` 타입 직후에는 `think` 타입 출제 확률을 30% 이하로 제어합니다.
    * `think` 타입은 반드시 `reflex` 혹은 쉬운 `pattern` 이후에 등장하여 뇌의 모드 전환을 돕습니다.
2. **다양성 붕괴 방지 (지루함 및 기계적 학습 차단)**: 
    * 최근 5문제 내 동일 `QType`(문제 유형) 연속 출제 최대 2회로 제한.
    * 최근 3문제 내 동일 `CognitiveType`(인지 유형) 연속 출제 최대 2회로 제한.

---

## 5. 실수 패턴 및 인지적 근접성 기반 오답(Distractors)
오답은 수학적인 값의 근접성(정답 주변의 숫자)이 아니라, 플레이어가 **'생각 없이 직관적으로 누를 때 고르는 값(인지적 근접성)'**이어야 합니다.
1. **패턴 착각 (Pattern Illusion)**: 예: $\sqrt{12}$의 정답 $2\sqrt{3}$의 오답으로 $3\sqrt{2}$를 배치.
2. **부호 반전 및 이항 실수**: 예: $+$, $-$ 계산 실수 및 이항 시 부호 변경 누락.
3. **연산 순서 및 지수 착각**: 예: 덧셈을 곱셈보다 먼저 하거나, 지수법칙을 단항식 곱셈으로 치환하는 실수.

---

## 6. 게임 흐름 및 하드코어 타이머 (인플레이션 방지)
* **타이머 로직 (서바이벌 패널티 및 시간 보상 감쇠)**: 초기 60초 시작.
    * **오답 시**: `-3.5초` (실수에 대한 치명적 패널티 부여)
    * **정답 시 (감쇠 적용)**: 상위권 유저의 무한 플레이(인플레이션)를 방지하기 위해 보상을 점진적으로 줄입니다.
        * 1~20번째 정답: `+2.5초`
        * 21~40번째 정답: `+1.2초`
        * 41번째 이후 정답: `+0.5초`
    * **임계값**: 최소 시간 `4초`, 상한선 `60초` 제한. (죽을 뻔한 긴장감 최소치 유지)
* **목표 퍼포먼스**: 
    * 1,000문제 생성 시 소요 시간 `1ms` 이하 보장 및 도형 렌더링 최소 부하 설계.
    * **리듬 테스트 목표**: 30문제 플레이 로그 기준, 4초 이상 멈춤(Pause) 비율 `18% 미만` 달성.

이 명세에 따라, 코어 생성기인 `MiddleMathGenerator.ts`와 도형 렌더링 컴포넌트, 그리고 게임 보드의 템포 관리 로직의 파이프라인을 구축합니다.
